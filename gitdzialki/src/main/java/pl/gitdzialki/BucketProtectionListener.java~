package pl.gitdzialki;

import org.bukkit.ChatColor;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerBucketEmptyEvent;
import org.bukkit.entity.Player;

import java.util.UUID;

public class BucketProtectionListener implements Listener {

    private final PlotManager plotManager;

    public BucketProtectionListener(PlotManager plotManager) {
        this.plotManager = plotManager;
    }

    @EventHandler
    public void onBucketEmpty(PlayerBucketEmptyEvent event) {
        Player player = event.getPlayer();
        Location location = event.getBlockClicked().getLocation(); // Lokalizacja, na którą wylewany jest płyn

        // Sprawdź, czy gracz wylewa którykolwiek z płynów lub substancji w kubełkach
        Material bucketType = event.getBucket();
        if (bucketType == Material.WATER_BUCKET ||
                bucketType == Material.LAVA_BUCKET ||
                bucketType == Material.POWDER_SNOW_BUCKET ||
                bucketType == Material.MILK_BUCKET ||
                bucketType == Material.COD_BUCKET ||
                bucketType == Material.SALMON_BUCKET ||
                bucketType == Material.TROPICAL_FISH_BUCKET ||
                bucketType == Material.PUFFERFISH_BUCKET) {
            if (plotManager.isPlot(location)) {
                UUID ownerUUID = plotManager.getPlotOwner(location);
                if (ownerUUID != null && !ownerUUID.equals(player.getUniqueId())) {
                    player.sendMessage(ChatColor.RED + "Nie możesz wylewać substancji na cudzą działkę!");
                    event.setCancelled(true);
                }
            }
        }
    }
}